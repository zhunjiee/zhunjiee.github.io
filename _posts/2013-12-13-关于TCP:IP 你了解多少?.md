---
layout: post
title: "关于TCP/IP 你了解多少?"
date: 2013-12-13
comments: false
categories: 知识囊
---

走近TCP/IP协议

##TCP/IP是什么？

**TCP/IP协议**(Transmission Control Protocol/Internet Protocol，传输控制协议/互联网络协议)是Internet最基本的协议。

在Internet没有形成之前，世界各地已经建立了很多小型网络，但这些网络存在不同的网络结构和数据传输规则，要将它们连接起来互相通信，就好比要让使用不同语言的人们交流一样，需要建立一种大家都听得懂的语言，而TCP/IP就能实现这个功能，它就好比Internet上的“世界语”。

TCP/IP协议**定义了主机如何连入因特网及数据如何在它们之间传输的标准**.

不同于ISO模型的七个分层，TCP/IP协议参考模型把所有的TCP/IP系列协议归类到四个抽象层中

- **应用层**：TFTP，HTTP，SNMP，FTP，SMTP，DNS，Telnet 等等
- **传输层**：TCP，UDP
- **网络层**：IP，ICMP，OSPF，EIGRP，IGMP
- **数据链路层**：SLIP，CSLIP，PPP，MTU

每一抽象层建立在低一层提供的服务上，并且为高一层提供服务，看起来大概是这样子的

图1 - TCP/IP系列协议
![](https://dn-zhunjiee.qbox.me/Snip20151119_3.jpg)


---
图2 - ISO模型的七个分层
![](https://dn-zhunjiee.qbox.me/Snip20151123_1.png)                        ﻿


在TCP/IP协议中两个因特网主机通过两个路由器和对应的层连接。各主机上的应用通过一些数据通道相互执行读取操作
![](https://dn-zhunjiee.qbox.me/Snip20151119_4.png)       

##TCP/IP究竟包括哪些协议？
TCP/IP是一组包括上百个功能协议的集合，下面列举几个常用的。

利用TCP/IP排除网络故障

**实例一:插好网卡，连上网线，但网络却不通**

*1.利用Ping确定故障大致范围*

- (1) Ping 127.0.0.1，如果失败，则表明本地机TCP/IP协议不能正常工作，请重装TCP/IP协议后再试。
- (2) Ping本机IP地址，如果失败，则表明网卡配置不正确。
- (3) Ping局域网内其他机器IP地址或Internet上主机地址，如果失败，则主要原因是网线没有连通;如果成功，但网络依然无法使用，则问题可能出在网络系统的软件配置上。

- 小提示
	- 某些电脑如果在网络防火墙中设置了禁止其他电脑对它执行Ping操作，则无论Ping多少次都不会成功。

*2.排除其他可能引起网络不通的原因*

除网络设置可能引起网络不通外，也有其他可能，下面列举几个典型故障:

(1)“网上邻居”看不到任何计算机、不能上网

故障表现: Ping本机IP地址成功，但在“网上邻居”里看不到任何其他计算机，且不能上网，检查TCP/IP各项配置都没有问题。

解决办法: 这种问题多数是由计算机病毒引起的，用最新的杀毒软件彻底查杀。
重装网卡驱动，因为驱动很可能已经遭到病毒破坏。

(2)某些集成网卡丢失地址导致无法上网

故障表现: Ping本机IP地址成功，但不能上网，执行ipconfig发现网卡的物理地址全是00！

解决办法: 检查CMOS设置里的“Integrated Perpherals”(内建周边设备)一项，在该项中的“MAC Address Input”(设置网卡的MAC地址)设置一个与其他网卡地址不相冲突的数值。

*3.总结*

看来网络不通的原因无非就是网络安装设置(如默认网关、DNS)和其他客观因素(如病毒)两个方面。在出现网络不通的故障时，综合运用Ping、ipconfig等相关命令以及网卡MAC地址等TCP/IP相关知识分析排除故障，往往能取得较好的效果。

**实例二:使用Tracert命令揭开网速奇慢之谜**

常常觉得访问某网站时奇慢无比？在没有确定原因之前请不要立刻怪罪你的ISP，因为你的电脑可能在连上要访问的网站前，先得经过10个以上的网络路由器，如果在这些路由器之中有一个或多个路由器反应太慢，那就会成为阻碍你快速访问该网站的绊脚石。那么，怎么确定绊脚石到底是谁呢？

*1.网速怎么就这么慢？*

(1)运行Tracert命令，如运行Tracert www.pcpchina.com来查看你连接www.pcpchina.com的服务器所经过的传输路径。

(2)查看结果(见图1)，其中包括每次停留的响应时间和沿路停留的IP地址等。如果发现某个路由器出现“*”号，则表明数据包在该路由器上停止传输了，从而导致上网速度特别慢，不过也可能是遇到了拒绝Tracert询问的路由器。
![图1](https://dn-zhunjiee.qbox.me/Snip20151119_2.jpg) 

*2.DNS服务问题引起Tracert失败*

局域网上的计算机无法浏览Internet，也无法对外发送和接收邮件。Tracert某域名，马上显示失败，但是Tracert其IP地址是正常的。如果遇到这种情况，那很可能是域名解析服务器出了问题，你可以在TCP/IP的配置中换一个DNS服务器。

**实例三:共享宽带时客户机访问某些网站不正常**

现在越来越多的家庭开始使用Windows自带的“Internet连接共享”来实现多台电脑共享宽带上网，该方法虽然简单，但相信很多朋友都遇到过这样一个问题:主机上网一切正常，可客户机去不了某些网站。

故障分析: Windows操作系统默认的TCP/IP数据包最大值MaxMTU为1500，而ADSL服务提供商实际使用的数据包最大值略小于1500，多为1492，所以需要降低MaxMTU的值到1492之下。

- MaxMTU与网络速度的关系
	- TCP/IP数据包最大值MaxMTU是影响Internet网上速度的重要参数，数据包的报头大小为20～60Byte，如果要发送30000Byte的数据， MaxMTU值为500时，要发送60个数据包;而MaxMTU值为1500时，仅需要发送20个数据包，显然前者要多发送40个报头，共800～2400Byte，占总数据量的2.6%～7.8%，所以MaxMTU值为1500时比MaxMTU值为500时速度提高了约2.6%～7.8%。许多ISP都调节MaxMTU值以获得更快的网络速度，我们设置的MaxMTU值不要大于ISP的MaxMTU值。

解决办法: 进入“注册表编辑器”的[HKEY_LOCAL_MACHINE SYSTEMCurrentControlSetServicesTcpipParametersInterfaces]，找到包含你电脑的IP地址、DNS服务器、默认网关等网络设置数据的那一项，在这项中新建双字节值，命名为“MTU”，设置其值为十进制的1450或其他小于1492的数值。设置完毕，重新启动电脑即可。

- 小提示
	- 可以使用类似超级兔子魔法设置之类专门的注册表优化工具来修改MaxMTU值:在“网络”下，启用“使用最大传输单元”，改为1450或者一个比1492小的值，重新启动电脑。

**实例四:通过端口信息判断是否中木马**

netstat命令可以用来显示本地和外部连接时开放的端口以及连接状态。
在“命令提示符”中输入“netstat -a”命令并回车。

查看结果，如果发现Port 12345(TCP) Netbus、Port 31337(UDP) Back Orifice之类的信息，那就说明中了木马，赶快杀毒吧！

##TCP/IP的未来之路:IPv6

TCP/IP作为一种同时具备了可扩展性和可靠性的网络协议，伴随着Internet的普及和迅速发展，IP协议第4个版本IPv4的瓶颈显露出来，其32位寻址功能不足以支持需要加入Internet的主机和网络数，通俗一点说，就是IP地址不够用了。这时，新标准IPv6腾空出世。

IPv6虽然还未普及，不过有时使用某种服务或安装某软件，如微软的ThreeDegrees软件时，就会提示需要IPv6支持。

TCP/IP协议作为全球使用最广泛的一个网络协议，包含了很多技巧和学问，用一本书来详细阐述也不为过，这篇文章主要讲解了一些基本知识、应用技巧和相关故障解决方法，希望能起到抛砖引玉的作用。IPv6目前的实用性还不算特别大，估计不久它就会派上大用场了，让我们拭目以待吧！